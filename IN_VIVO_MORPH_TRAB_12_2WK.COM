$!      $!         _/_/_/  _/_/_/    _/        $!          _/    _/    _/  _/           Image Processing Language  $!         _/    _/_/_/    _/ $!        _/    _/        _/             (c) Andres Laib, IBT/ETH Zürich$!     _/_/_/  _/        _/_/_/_/                         Scanco Medical$!        $!$!$!  IPL Batch Scanco$!$!$!============================================================================$! call as: $! @in_vivo_morph c0000001.aim c0000002.aim$!$!=============================================================================$!$! define thresholds for bone gain and loss and segmentation threshold$!$  THRES_LOSS :==  -2.40       ! mu$  THRES_GAIN :==   2.40        ! mu$  THRES_SEG  :==   360     ! [1/1000]$  CL_SIZE    :==   15         ! Minimum amount of voxels $!$! define additional files based on image1 name$!$   FILENAME = F$PARSE("''P1'",,,"NAME")$   DEV      = F$PARSE("''P1'",,,"DEVICE")$   DIR      = F$PARSE("''P1'",,,"DIRECTORY")$   FILEBASE  :== 'DEV''DIR''FILENAME'   ! without extension$!$   DEFINE   IN1_FILE     'FILEBASE'".AIM"$   DEFINE   GOBJ1_FILE   'FILEBASE'".GOBJ"$!$! define output file based on image2 name$!$   FILENAME = F$PARSE("''P2'",,,"NAME")$   DEV      = F$PARSE("''P2'",,,"DEVICE")$   DIR      = F$PARSE("''P2'",,,"DIRECTORY")$   FILEBASE  :== 'DEV''DIR''FILENAME'   ! without extension$!$   DEFINE   IN2_FILE     'FILEBASE'".AIM"$   DEFINE   GOBJ2_FILE   'FILEBASE'".GOBJ"$!$! define output files based on output name$!$!   FILENAME = F$PARSE("''P3'",,,"NAME")$!   DEV      = F$PARSE("''P3'",,,"DEVICE")$!   DIR      = F$PARSE("''P3'",,,"DIRECTORY")$!   FILEBASE  :== 'DEV''DIR''FILENAME'   ! without extension$!$!$!$   show log in1_file$   show log gobj1_file$   show log in2_file$   show log gobj2_file$!$!$ ON ERROR THEN EXIT$!$iplregreadin1in1_filereadin2in2_fileheader_geo_setin2-1 -1 -1-1 -1 100-1 -1 -1gobj_to_aimgobj2_filewk2_rough_gobj0header_geo_setwk2_rough_gobj-1 -1 -1-1 -1 100.005 .005 .005togobjwk2_rough_gobjwk2_rough_offset.gobj001registerin1wk1_rot_rough.gobjin2wk2_rough_offset.gobjTMAT23_tmp.DAT20.0  0.0  0.00.0  0.0  0.0.10 .10 .10.10 .10 .1010 4 11.00 0.10 0.0100.000010.501110001transformin2in2_tmpTMAT23_tmp.DAT1-1.000 -1.000 -1.000falsedel in2transformwk2_rough_gobjwk2_rough_gobj_tmpTMAT23_tmp.DAT0-1.000 -1.000 -1.000falseregisterin1gobj1_filein2_tmpgobj1_fileTMAT23.DAT20.0  0.0  0.00.0  0.0  0.00.10 0.10 0.10.10 0.10 0.1010 4 11.0 0.10 0.100.000010.501110001transformin2_tmpin2_regTMAT23.DAT1-1.000 -1.000 -1.000falsetransformwk2_rough_gobj_tmpwk2_rough_gobj_finalTMAT23.DAT0-1.000 -1.000 -1.000falsedel in1_tmpdel in2_tmp_cutdel wk2_rough_gobj_tmptogobj_from_aimwk2_rough_gobj_finalwk2_rot_rough.gobj005writein2_regwk2roughrot.aimbintruedel wk2_rough_gobj_finalgauss_segin1in1_check.81"THRES_SEG10000200gauss_segin2_regin2_reg_check.81"THRES_SEG10000400add_aimsin1_checkin2_reg_checkoverlap_checkwriteoverlap_checkoverlap_check.aimbintruedel in1_checkdel in2_reg_checkdel in2_gobj_tmp_aim_rotdel in2_tmpdel in2_gobj_tmp_aimgobj_to_aimgobj1_filein1_gobj0thresholdin1_gobjcommon127100000105boundcommoncommon_boundedtrue0 0 0togobj_from_aimcommon_boundedCOMMON_MASK.GOBJ005togobj_from_aimcommon_boundedwk2_rot.gobj005del common_boundeddel outdel reg_gobjdel in1_gobjwritein2_regwk2_rot.aimbintrueboundin2_regin2_reg_boundedtrue0 0 0gaussin2_reg_boundedin2_reg_gauss.81gaussin1in1_gauss0.81subtract_aimsin2_reg_gaussin1_gaussdiffthresholddiffgain"THRES_GAIN         100001271thresholddiffloss-10000"THRES_LOSS        1271del diffcl_nr_extractgaingain_cl"CL_SIZE          060cl_nr_extractlossloss_cl"CL_SIZE          040del gaindel lossseg_gauss                 in1in1_seg.81"THRES_SEG10000200seg_gauss                 in1in1_seg_mask.81"THRES_SEG10000200togobjin1_seg_maskbone_wk1_mask.gobj005invertin1_seg_mask-1-1togobjin1_seg_maskbone_wk1_mask_invert.gobj005del in1_seg_maskseg_gaussin2_regin2_reg_gauss_seg.81"THRES_SEG10000200seg_gaussin2_regin2_reg_gauss_seg_mask.81"THRES_SEG10000200togobjin2_reg_gauss_seg_maskbone_wk2_mask.gobj005invertin2_reg_gauss_seg_mask-1-1togobjin2_reg_gauss_seg_maskbone_wk2_mask_invert.gobj005gobjgain_clbone_wk1_mask_invert.gobj0gobjloss_clbone_wk1_mask.gobj0gobjloss_clbone_wk2_mask_invert.gobj0subtract_aimsin2_reg_gauss_segin1_segthresh_diffthresholdthresh_diffthresh_gain19100000.000000605thresholdthresh_diffthresh_loss-10000-19405del thresh_diffcl_nr_extractthresh_lossthresh_loss_cl"CL_SIZE          040del thresh_losscl_nr_extractthresh_gainthresh_gain_cl"CL_SIZE          060del thresh_gaingobjthresh_gain_clbone_wk1_mask_invert.gobj0gobjthresh_loss_clbone_wk1_mask.gobj0gobjthresh_loss_clbone_wk2_mask_invert.gobj0add_aimsin1_segin2_reg_gauss_segcommon_bonedel in2_reg_gauss_segthresholdcommon_bonealways_bone3941805del common_bonewritealways_bonealways_bone_check.aimbintrueset_valuein1_seg8020concatin1_segloss_cltmpfalsefalsefalse0 0 00.0-1 -1del loss_clconcattmpgain_cltmp2falsefalsefalse0 0 00.0-1 -1del tmpdel gain_clconcattmp2thresh_loss_cltmp3falsefalsefalse0 0 00.0-1 -1del tmp2del thresh_loss_clconcattmp3thresh_gain_cltmp4             falsefalsefalse0 0 00.0-1 -1del tmp3del thresh_gain_clconcattmp4always_bonefinal_unboundedfalsefalsefalse0 0 00.0-1 -1del tmp4del always_boneboundfinal_unboundedfinaltrue0 0 0del final_unboundedwritefinal12_combined_comp.aimbintruedel finaldel tmp2del in1_segdel in2_regq